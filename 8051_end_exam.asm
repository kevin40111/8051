	ORG	0
CLEAN:	
	MOV	P0,#FFH
	MOV	P2,#FFH
	MOV	P3,#FFH
	MOV	R5,#0
	MOV	R4,#0
GO:
	CALL	START
	JMP	GO
START:	
	MOV	R0,#0
	MOV	R1,#4
	MOV	R2,#EFH

SCAN:	MOV	A,R2
	MOV	P1,A

	JNB	P1.0,KEYIN
	INC	R0
	JNB	P1.1,KEYIN
	INC	R0
	JNB	P1.2,KEYIN
	INC	R0
	JNB	P1.3,KEYIN
	INC	R0

	MOV	A,R2
	RL	A
	MOV	R2,A
	DJNZ	R1,SCAN
	JMP	START

KEYIN:	CALL	DELAY
	CALL	DELAY
	CALL	DELAY
	

	CJNE	R0,#0,A0 	
	MOV	R3,#7
	JMP	HW1
A0:	CJNE	R0,#1,A1 	
	MOV	R3,#8
	JMP	HW1
A1:	CJNE	R0,#2,A2 	
	MOV	R3,#9
	JMP	HW1
A2:	CJNE	R0,#4,A3	
	MOV	R3,#4
	JMP	HW1	
A3:	CJNE	R0,#5,A4	
	MOV	R3,#5
	JMP	HW1
A4:	CJNE	R0,#6,A5	
	MOV	R3,#6
	JMP	HW1
A5:	CJNE	R0,#8,A6	
	MOV	R3,#1
	JMP	HW1
A6:	CJNE	R0,#9,A7	
	MOV	R3,#2
	JMP	HW1
A7:	CJNE	R0,#10,A8	
	MOV	R3,#3
	JMP	HW1
A8:	CJNE	R0,#12,A9	
	MOV	R3,#0
	JMP	HW1
A9:	CJNE	R0,#13,A10	
	JMP	SETR5
	
A10:	CJNE	R0,#14,A11	
	JMP	CLEAN

A11:	RET


	

SCAN2:	MOV	R2,#7FH
	MOV	A,R2
	MOV	P1,A
	JNB	P1.3,GOBACK
	
	RET
GOBACK:	JMP	CLEAN

SETR5:	
	MOV	B,#10
	MOV	A,R5
	MUL	AB
	MOV	R5,A
	MOV	A,R3
	ADD	A,R5
	MOV	R4,A
	MOV	R5,A
	JMP	GTR

RTG:	
	MOV	A,R4
	MOV	R5,A
DELAY1:
	MOV	P3,#11011110B;
	CALL	SCAN2
	
	CALL	DELAY
	CALL	DELAY
	CALL	DELAY
	CALL	DELAY
	CALL	RIGHTLED
	DJNZ	R5,DELAY1
	
	
	MOV	P3,#10111110B;
	CALL	DELAY
	CALL	DELAY
	CALL	DELAY
	CALL	DELAY
	CALL	DELAY
	CALL	DELAY
	CALL	DELAY
	CALL	DELAY
	CALL	DELAY
	CALL	DELAY
	CALL	DELAY
	CALL	DELAY	
	CALL	DELAY
	CALL	DELAY
	CALL	DELAY
	CALL	DELAY

GTR:	
	MOV	A,R4
	MOV	R5,A
DELAY2:	
	MOV	P3,#01111011B;
	CALL	SCAN2
	
	CALL	DELAY
	CALL	DELAY
	CALL	DELAY
	CALL	DELAY
	CALL	RIGHTLED
	DJNZ	R5,DELAY2	
		
	MOV	P3,#01111101B;
	CALL	DELAY
	CALL	DELAY
	CALL	DELAY
	CALL	DELAY	
	CALL	DELAY
	CALL	DELAY
	CALL	DELAY
	CALL	DELAY
	CALL	DELAY
	CALL	DELAY
	CALL	DELAY
	CALL	DELAY	
	CALL	DELAY
	CALL	DELAY
	CALL	DELAY
	CALL	DELAY
	JMP	RTG

	
HW1:	MOV	A,R3
	
	CJNE	R5,#0,CROSS
	MOV	R5,A
	
	MOV	DPTR,#LED1
	MOVC	A,@A+DPTR
	MOV	P0,A
	
	JMP	START
CROSS:	PUSH	A
	MOV	A,R5
	MOV	DPTR,#LED1
	MOVC	A,@A+DPTR
	MOV	P2,A
	
	POP	A
	MOV	DPTR,#LED1
	MOVC	A,@A+DPTR
	MOV	P0,A
	JMP	START

RIGHTLED:
	MOV	A,R5
	MOV	B,#10
	DIV	AB

	MOV	DPTR,#LED1
	MOVC	A,@A+DPTR
	MOV	P2,A
	
	MOV	A,B
	MOV	DPTR,#LED1
	MOVC	A,@A+DPTR
	MOV	P0,A
	
	RET
LED1:	
	DB	00000011B
	DB	10011111B
	DB	00100101B
	DB	00001101B
	DB	10011001B
	DB	01001001B
	DB	11000001B
	DB	00011011B
	DB	00000001B
	DB	00011001B

DELAY:	
	MOV	R7,#200
D1:	MOV	R6,#200
	DJNZ	R6,$
	DJNZ	R7,D1
	RET
	END